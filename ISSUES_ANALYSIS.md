# Анализ основных проблем проекта P≠NP (Lean 4)

**Дата**: 2026-02-08

---

## Краткое резюме

Проект — формализация в Lean 4 условного доказательства P ≠ NP через схемную сложность и hardness magnification. Текущее состояние: основная цепочка A→B→C→D собрана и компилируется, `sorry` в активном коде нет, но результат **условный** — зависит от внешних свидетельств и одной аксиомы. Ниже ранжированы ключевые проблемы от наиболее критичных к менее.

---

## Проблема 1 (критическая): Multi-switching индукция для depth > 2 отсутствует

**Суть**: polylog-оценка глубины decision tree (`t ≤ (log₂(M+2))^(d+1)`) доказана конструктивно **только для depth-2** (CNF/DNF). Для общей глубины AC⁰-схем (`d > 2`) нет ни CCDT-индукции, ни склейки shrinkage-сертификатов, ни вероятностного слоя.

**Влияние**: это **единственный блокер** для перехода от Stage-1 (слабая оценка `M²`) к Stage-2 (полноценный polylog). Без polylog-bound:
- `ac0DepthBound` нельзя перевести на `ac0DepthBound_strong`
- внешние shrinkage-свидетели (`AC0CircuitWitness`, `LocalCircuitWitness`) остаются обязательными входами
- условность P ≠ NP не снимается

**Конкретные недостающие компоненты** (из `MultiSwitching_DepthInduction_TODO.md`):
1. CCDT-алгоритм для depth > 2 (тип `CCDTAlgorithm` для общих depth-d формул)
2. Индукционный шаг `d → d+1` со склейкой shrinkage-сертификатов
3. ε-бюджет по уровням (линейный: `ε_level ≤ 1/((d+1)(n+2))`)
4. Финальная конструкция `AC0MultiSwitchingWitness` из индукции

**Оценка трудоёмкости**: 400–800 часов (по `AXIOM_FEASIBILITY_ANALYSIS.md`).

**Файлы**: `pnp3/AC0/MultiSwitching/DepthInduction.lean`, `Main.lean`, `Counting.lean`.

---

## Проблема 2 (критическая): Внешние shrinkage-свидетели не построены

**Суть**: две ключевые switching-теоремы формально доказаны, но параметризованы **внешними** свидетельствами:
- `partial_shrinkage_for_AC0` — требует `AC0CircuitWitness` через `FamilyIsAC0`
- `shrinkage_for_localCircuit` — требует `LocalCircuitWitness` через `FamilyIsLocalCircuit`

Эти свидетели не строятся внутри проекта. Они передаются как параметры, что делает конечный вывод `P_ne_NP_final` условным (гипотеза `hF_all`).

**Связь с Проблемой 1**: полное закрытие multi-switching (Проблема 1) автоматически снимет необходимость во внешних свидетелях для AC⁰. Для `shrinkage_for_localCircuit` дополнительно нужен мост через locality lift (ещё 100–200 часов).

**Файлы**: `pnp3/ThirdPartyFacts/Facts_Switching.lean`, `pnp3/ThirdPartyFacts/PartialLocalityLift.lean`.

---

## Проблема 3 (существенная): Аксиома NP-трудности Partial MCSP

**Суть**: единственная **активная аксиома** в проекте — `PartialMCSP_is_NP_Hard` в `pnp3/ThirdPartyFacts/Hirahara2022.lean`. Это результат Hirahara (2022), принятый без формального доказательства.

**Влияние**: даже при полном закрытии multi-switching (Проблемы 1–2) вся цепочка P ≠ NP будет зависеть от этой аксиомы. Для полностью безусловного статуса необходимо:
- либо полностью формализовать доказательство NP-трудности Partial MCSP в Lean
- либо импортировать верифицированную формализацию

**Сложность**: формализация требует randomized reductions, что значительно расширяет объём probabilistic toolkit, необходимого проекту.

**Файлы**: `pnp3/ThirdPartyFacts/Hirahara2022.lean`.

---

## Проблема 4 (существенная): Слабая глубинная оценка `M²` вместо polylog

**Суть**: текущий дефолт `ac0DepthBound = ac0DepthBound_weak = M²`. Эта оценка честная и полностью формальная для depth-2, но **не достаточна** для финальной цели P ≠ NP при типичных параметрах `M = n^k`.

**Влияние**: при `M = n^k` условие малости (`M²` < необходимый порог) перестаёт работать для большинства значений `k`. Stage-1 оценка — это baseline, но не финальный результат.

**Статус**: контракт Stage-1/Stage-2 разделён корректно: `ac0DepthBound_weak` и `ac0DepthBound_strong` существуют отдельно. Переключение на `strong` заблокировано Проблемой 1.

**Файлы**: `pnp3/ThirdPartyFacts/Facts_Switching.lean` (определения `ac0DepthBound_weak`, `ac0DepthBound_strong`).

---

## Проблема 5 (архитектурная): Несогласованность DNF/CNF-моделей

**Суть**: основной multi-switching pipeline реализован для **CNF**, а downstream-код (античекер, shrinkage-сертификаты) ожидает **DNF**-объекты. Для согласования требуется:
1. Мост `AC0.Formulas.DNF → Core.DNF` через width/Nodup (частично реализован)
2. Duality-слой для DNF↔CNF (реализован базово в `Duality.lean`)
3. Width-aware view для AC⁰-формул (модуль `AC0/Width.lean` запланирован, не реализован)
4. Нормализация термов для получения `Nodup` + сохранения `eval`

**Влияние**: без полного моста polylog-доказательство для depth > 2 "доказывает не тот объект" — multi-switching контролирует глубину decision tree, а target witness привязан к `allSubcubes.length` исходного DNF.

**Статус**: в `AC0_SHRINKAGE_PLAN.md` явно отмечено как "критическая несостыковка №1". Частично решено: `toCoreDNF` + `eval_toCoreDNF` существуют с предпосылками `width` и `Nodup`.

**Файлы**: `pnp3/AC0/MultiSwitching/Duality.lean`, `Definitions.lean`, `Truncation.lean`.

---

## Проблема 6 (архитектурная): LeafPartition для canonical CCDT

**Суть**: лемма `shrinkage_negDnfFamily_to_dnf` (мост DNF↔CNF для shrinkage) требует предпосылку `LeafPartition` на листьях дерева. Для canonical CCDT-деревьев это свойство должно быть доказано, но **пока не реализовано**.

**Влияние**: без `CCDT.leafPartition` мост DNF→CNF для shrinkage-сертификатов не замыкается автоматически. Это блокирует использование CNF-pipeline для получения DNF-результатов.

**Решение**: добавить лемму `CCDT.leafPartition` или включить `LeafPartition` как поле в shrinkage-сертификат.

**Файлы**: `pnp3/AC0/MultiSwitching/ShrinkageFromGood.lean`.

---

## Проблема 7 (средняя): Открытые вопросы архитектуры индукции

В `MultiSwitching_DepthInduction_TODO.md` зафиксированы **8 неотвеченных вопросов**, без решения которых нельзя корректно завершить индукцию:

1. Формат индукционного шага: один CCDT или `d` отдельных?
2. Базовый объект: `Shrinkage` (PDT) или `PartialCertificate` (trunk+tails)?
3. Вероятностный vs детерминированный подсчёт на каждом уровне
4. Параметризация `t, s, p` — классика Håstad или приближённая схема?
5. CNF-pipeline как canonical или двойной шаг?
6. Формат ε-бюджета (линейный vs геометрический)
7. Формула итоговой глубины
8. Формат LeafPartition (поле vs лемма)

Часть вопросов уже имеет предварительные ответы (CNF-pipeline принят, линейный бюджет выбран), но формальное закрепление в коде не сделано.

---

## Проблема 8 (инфраструктурная): Объём документации vs код

**Суть**: проект содержит **14+ документов** в формате Markdown общим объёмом > 150 KB, описывающих планы, архитектуру, состояние аксиом. При этом:
- некоторые документы частично дублируют друг друга (`TODO.md`, `AC0_SHRINKAGE_PLAN.md`, `MultiSwitching_DepthInduction_TODO.md`)
- часть решений зафиксирована в одном документе, но не отражена в другом
- дата обновления отдельных документов отстаёт от фактического состояния кода

**Риск**: рассинхронизация документации может привести к повторной работе или неверным архитектурным решениям.

---

## Сводная таблица

| # | Проблема | Критичность | Блокирует | Оценка (ч) |
|---|----------|-------------|-----------|------------|
| 1 | Multi-switching для depth > 2 | Критическая | polylog, снятие условности | 400–800 |
| 2 | Внешние shrinkage-свидетели | Критическая | безусловность P ≠ NP | → Пр.1 |
| 3 | Аксиома NP-трудности MCSP | Существенная | полная безусловность | 200–400 |
| 4 | Слабая оценка M² | Существенная | финальный результат | → Пр.1 |
| 5 | DNF/CNF несогласованность | Архитектурная | корректность индукции | 40–80 |
| 6 | LeafPartition не доказана | Архитектурная | мост DNF↔CNF | 10–20 |
| 7 | Открытые вопросы архитектуры | Средняя | начало реализации | решения |
| 8 | Рассинхронизация документации | Инфраструктурная | — | 10–20 |

---

## Рекомендуемый порядок действий

1. **Закрыть архитектурные вопросы** (Проблема 7) — принять решения по формату индукции
2. **Реализовать мосты DNF↔CNF** (Проблемы 5, 6) — база для индукции
3. **Построить multi-switching для depth > 2** (Проблема 1) — основная работа
4. **Интегрировать witness** (Проблема 2) — следует автоматически из п.3
5. **Рассмотреть формализацию NP-трудности** (Проблема 3) — долгосрочно
