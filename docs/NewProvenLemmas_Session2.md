# –ù–æ–≤—ã–µ –¥–æ–∫–∞–∑–∞–Ω–Ω—ã–µ –ª–µ–º–º—ã (—Å–µ—Å—Å–∏—è 2)

**–î–∞—Ç–∞:** 2025-10-21
**–ó–∞–¥–∞—á–∞:** –î–æ–∫–∞–∑–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–µ–º–º—ã –±–µ–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ 12 –Ω–æ–≤—ã—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–æ–∫–∞–∑–∞–Ω–Ω—ã—Ö –ª–µ–º–º + lake test PASSED

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|---------|-------|--------|-----------|
| –ü–æ–ª–Ω–æ—Å—Ç—å—é –¥–æ–∫–∞–∑–∞–Ω–Ω—ã–µ –ª–µ–º–º—ã | 10 | **22** | **+12 ‚úÖ** |
| –õ–µ–º–º—ã —Å sorry | 14 | 14 | 0 |
| –í—Å–µ–≥–æ sorry | 22 | 22 | 0 |
| Lake test | - | **PASSED** | **‚úÖ** |

---

## ‚úÖ –ù–æ–≤—ã–µ –¥–æ–∫–∞–∑–∞–Ω–Ω—ã–µ –ª–µ–º–º—ã (12)

### –ö–∞—Ç–µ–≥–æ—Ä–∏—è 1: Barcode operations (5 –ª–µ–º–º)

–î–æ–∫–∞–∑–∞–Ω—ã –±–∞–∑–æ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –ø—É—Å—Ç–æ–≥–æ –±–∞—Ä–∫–æ–¥–∞ –∏ –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ –Ω–∏–º:

```lean
@[simp] lemma empty_steps : (empty n).steps = [] := rfl
```
**–ß—Ç–æ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç:** –ü—É—Å—Ç–æ–π –±–∞—Ä–∫–æ–¥ –∏–º–µ–µ—Ç –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ —à–∞–≥–æ–≤
**–¢–µ—Ö–Ω–∏–∫–∞:** –ü—Ä—è–º–æ–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

```lean
@[simp] lemma empty_get? (i : Nat) : (empty n).get? i = none
```
**–ß—Ç–æ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç:** –ü–æ–ª—É—á–µ–Ω–∏–µ –ª—é–±–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ –∏–∑ –ø—É—Å—Ç–æ–≥–æ –±–∞—Ä–∫–æ–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç none
**–¢–µ—Ö–Ω–∏–∫–∞:** Unfold + simp

```lean
@[simp] lemma empty_maxTermIdx : (empty n).maxTermIdx = 0
```
**–ß—Ç–æ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å —Ç–µ—Ä–º–∞ –≤ –ø—É—Å—Ç–æ–º –±–∞—Ä–∫–æ–¥–µ —Ä–∞–≤–µ–Ω 0
**–¢–µ—Ö–Ω–∏–∫–∞:** Unfold + simp

```lean
@[simp] lemma empty_termIndices : (empty n).termIndices = []
```
**–ß—Ç–æ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç:** –°–ø–∏—Å–æ–∫ –∏–Ω–¥–µ–∫—Å–æ–≤ —Ç–µ—Ä–º–æ–≤ –≤ –ø—É—Å—Ç–æ–º –±–∞—Ä–∫–æ–¥–µ –ø—É—Å—Ç
**–¢–µ—Ö–Ω–∏–∫–∞:** Unfold + simp

```lean
lemma steps_length (bc : Barcode n t) : bc.steps.length = t
```
**–ß—Ç–æ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç:** –î–ª–∏–Ω–∞ —Å–ø–∏—Å–∫–∞ —à–∞–≥–æ–≤ —Ä–∞–≤–Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—É t
**–¢–µ—Ö–Ω–∏–∫–∞:** –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ bc.property

---

### –ö–∞—Ç–µ–≥–æ—Ä–∏—è 2: setVar properties (2 –ª–µ–º–º—ã)

–î–æ–∫–∞–∑–∞–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ setVar:

```lean
lemma setVar_idempotent (œÅ : Restriction n) (i : Fin n) (b : Bool)
    (h : œÅ i = some b) :
    setVar œÅ i b = œÅ
```
**–ß—Ç–æ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç:** –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ —Ç–æ –∂–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –º–µ–Ω—è–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
**–¢–µ—Ö–Ω–∏–∫–∞:** Extensionality + case analysis + simp

```lean
lemma setVar_eq_or_same (œÅ : Restriction n) (i j : Fin n) (b : Bool) :
    setVar œÅ i b j = some b ‚à® setVar œÅ i b j = œÅ j
```
**–ß—Ç–æ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç:** setVar –ª–∏–±–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ, –ª–∏–±–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—Ç–∞—Ä–æ–µ
**–¢–µ—Ö–Ω–∏–∫–∞:** Case analysis on j = i

---

### –ö–∞—Ç–µ–≥–æ—Ä–∏—è 3: Compatible & Extension relations (5 –ª–µ–º–º)

–î–æ–∫–∞–∑–∞–Ω—ã —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π compatible –∏ Extension:

```lean
lemma compatible_symm {œÅ‚ÇÅ œÅ‚ÇÇ : Restriction n}
    (h : compatible œÅ‚ÇÅ œÅ‚ÇÇ) :
    compatible œÅ‚ÇÇ œÅ‚ÇÅ
```
**–ß—Ç–æ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç:** –û—Ç–Ω–æ—à–µ–Ω–∏–µ compatible —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ
**–¢–µ—Ö–Ω–∏–∫–∞:** –ü—Ä—è–º–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è + symmetry

```lean
@[simp] lemma compatible_refl (œÅ : Restriction n) :
    compatible œÅ œÅ
```
**–ß—Ç–æ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç:** –û—Ç–Ω–æ—à–µ–Ω–∏–µ compatible —Ä–µ—Ñ–ª–µ–∫—Å–∏–≤–Ω–æ
**–¢–µ—Ö–Ω–∏–∫–∞:** Trivial (–ª—é–±–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å —Å–æ–±–æ–π)

```lean
lemma Extension_compatible {œÅ‚ÇÅ œÅ‚ÇÇ : Restriction n}
    (h : Extension œÅ‚ÇÅ œÅ‚ÇÇ) :
    compatible œÅ‚ÇÅ œÅ‚ÇÇ
```
**–ß—Ç–æ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç:** –ï—Å–ª–∏ œÅ‚ÇÅ —Ä–∞—Å—à–∏—Ä—è–µ—Ç œÅ‚ÇÇ, —Ç–æ –æ–Ω–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã
**–¢–µ—Ö–Ω–∏–∫–∞:** –ü—Ä—è–º–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π

```lean
lemma emptyRestriction_Extension (œÅ : Restriction n) :
    Extension œÅ (emptyRestriction n)
```
**–ß—Ç–æ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç:** –õ—é–±–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä—è–µ—Ç –ø—É—Å—Ç–æ–µ
**–¢–µ—Ö–Ω–∏–∫–∞:** Contradiction (–ø—É—Å—Ç–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–µ –∏–º–µ–µ—Ç assigned –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö)

```lean
lemma setVar_emptyRestriction_Extension (i : Fin n) (b : Bool) :
    Extension (setVar (emptyRestriction n) i b) (emptyRestriction n)
```
**–ß—Ç–æ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç:** setVar –Ω–∞ –ø—É—Å—Ç–æ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–∏ —Ä–∞—Å—à–∏—Ä—è–µ—Ç –ø—É—Å—Ç–æ–µ
**–¢–µ—Ö–Ω–∏–∫–∞:** Contradiction (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ª–µ–º–º–µ)

---

## üéØ –ó–Ω–∞—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ª–µ–º–º

### –î–ª—è Barcode infrastructure:

–õ–µ–º–º—ã –æ –ø—É—Å—Ç–æ–º –±–∞—Ä–∫–æ–¥–µ –≤–∞–∂–Ω—ã –¥–ª—è:
- –ë–∞–∑–æ–≤–æ–≥–æ —Å–ª—É—á–∞—è –≤ –∏–Ω–¥—É–∫—Ü–∏—è—Ö –ø–æ –¥–ª–∏–Ω–µ –±–∞—Ä–∫–æ–¥–∞
- –†–∞–±–æ—Ç—ã —Å –∫—Ä–∞–µ–≤—ã–º–∏ —Å–ª—É—á–∞—è–º–∏ (t = 0)
- –£–ø—Ä–æ—â–µ–Ω–∏—è –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤ —á–µ—Ä–µ–∑ simp –∞—Ç—Ä–∏–±—É—Ç—ã

### –î–ª—è setVar algebra:

–ù–æ–≤—ã–µ –ª–µ–º–º—ã –¥–æ–ø–æ–ª–Ω—è—é—Ç –∞–ª–≥–µ–±—Ä—É –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π:
- **setVar_idempotent** - —É–ø—Ä–æ—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- **setVar_eq_or_same** - –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è case analysis

### –î–ª—è Compatible/Extension —Ç–µ–æ—Ä–∏–∏:

–§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π:
- **compatible_symm + refl** - –¥–µ–ª–∞—é—Ç compatible equivalence relation (–µ—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–æ—Å—Ç—å)
- **Extension_compatible** - —Å–≤—è–∑—ã–≤–∞–µ—Ç –¥–≤–∞ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–Ω—è—Ç–∏—è
- **emptyRestriction –ª–µ–º–º—ã** - –±–∞–∑–æ–≤—ã–µ —Å–ª—É—á–∞–∏ –¥–ª—è –∏–Ω–¥—É–∫—Ü–∏–π

---

## üß™ Lake Test Results

```bash
‚úÖ Lake test PASSED
```

**–î–µ—Ç–∞–ª–∏:**
- –í—Å–µ 2901 –º–æ–¥—É–ª—è —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω—ã
- –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ
- –¢–æ–ª—å–∫–æ linter warnings (—Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ, –Ω–µ –æ—à–∏–±–∫–∏)
- –¢–µ—Å—Ç—ã –≤ `pnp3/Tests/Switching_Basics.lean` –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–∏–º–µ—Ä—ã —É—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:**
```
info: pnp3/Tests/Switching_Basics.lean:164:0: 1
info: pnp3/Tests/Switching_Basics.lean:166:0: true
info: pnp3/Tests/Switching_Basics.lean:168:0: (1 : Rat)/2
```

---

## üìà –û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ –æ–±–µ —Å–µ—Å—Å–∏–∏

| –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ |
|------------|------------|
| **–í—Å–µ–≥–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–æ–∫–∞–∑–∞–Ω–Ω—ã—Ö –ª–µ–º–º** | **22** |
| –°–µ—Å—Å–∏—è 1 (buildSteps chain) | 10 |
| –°–µ—Å—Å–∏—è 2 (–±–µ–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞) | 12 |
| –î–æ–±–∞–≤–ª–µ–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –ª–µ–º–º (—Å sorry) | 4 |
| **–í—Å–µ–≥–æ –ª–µ–º–º —Å –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞–º–∏ –∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π** | **26** |

---

## üöÄ –¢–µ—Ö–Ω–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –≤ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞—Ö

1. **–ü—Ä—è–º–æ–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ (rfl)** - –¥–ª—è —Ç—Ä–∏–≤–∏–∞–ª—å–Ω—ã—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π
2. **Unfold + simp** - –¥–ª—è –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤ —á–µ—Ä–µ–∑ —É–ø—Ä–æ—â–µ–Ω–∏–µ
3. **Extensionality (ext)** - –¥–ª—è —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ —Ñ—É–Ω–∫—Ü–∏–π
4. **Case analysis (by_cases)** - –¥–ª—è —Ä–∞–∑–±–æ—Ä–∞ —Å–ª—É—á–∞–µ–≤
5. **Contradiction** - –¥–ª—è –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π
6. **–ü—Ä—è–º–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π** - –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª–µ–¥—Å—Ç–≤–∏–π

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ:**
- ‚úÖ –î–æ–∫–∞–∑–∞–Ω–æ 12 –Ω–æ–≤—ã—Ö –ª–µ–º–º –±–µ–∑ sorry
- ‚úÖ –í—Å–µ –ª–µ–º–º—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏
- ‚úÖ Lake test —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü—Ä–æ–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å—Ç–∞–±–∏–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö —Ä–µ–≥—Ä–µ—Å—Å–∏–π –∏–ª–∏ –ø–æ–ª–æ–º–æ–∫

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
- –ú–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –ª–µ–º–º–∞–º–∏, —Ç—Ä–µ–±—É—é—â–∏–º–∏ –≤–Ω–µ—à–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
- –ò–ª–∏ —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º encoding length invariant
- –ò–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º Term.restrictList API
