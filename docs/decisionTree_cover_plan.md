# План доказательства `decisionTree_cover`

Документ описывает текущий прогресс и дальнейшие шаги по замене аксиомы
`LowSensitivityCover.decisionTree_cover` полноценным формальным доказательством.
Во всех рассуждениях допускается использование классической логики и аксиомы
выбора.

## Состояние проекта

- В `low_sensitivity_cover.lean` утверждение `decisionTree_cover` пока объявлено
  как `axiom`.
- Реализованы базовые структуры: `Family`, `DecisionTree`, `Subcube`,
  `FamilyCover`.
- Доказаны вспомогательные леммы:
  - `DecisionTree.leaf_count_le_pow_depth`;
  - `H₂_restrict_le`;
  - `sunflower_exists_classic`;
  - набор фактов о мере: `measure_restrict_le`, `measure_filter_le`,
    `measure_empty`, `measure_singleton`, `measure_pos_of_card_two_le`,
    `measure_restrict_lt_of_card_le_half`, `measure_filter_lt_of_card_le_half`.
- Существует каркас для объединения покрытий (`merge_low_sens.lean`) и
  добавлены леммы `merge_card_le_low_sens` и `merge_card_le_entropy` для оценки
  числа субкубов в объединённом покрытии; зафиксирована безопасная константа
  `C = 10` для всех асимптотических оценок.

## Ключевые вопросы и текущий статус

1. **Энтропийная оценка**  
   *Сделано:* введена мера `measure F = Nat.ceil (H₂ F)` и принято безопасное
   ограничение `measure F ≤ 10 · s · log₂(n+1)`.  
   *Осталось:* при необходимости уточнить константу, формализовав оценку
   `(n+1)^{O(s)}` из работы Gopalan–Moshkovitz–Oliveira.

2. **Строгое уменьшение меры**  
 *Сделано:* леммы `measure_restrict_le`, `measure_restrict_decreases`,
  `measure_restrict_lt_of_card_le_half` и `measure_filter_lt_of_card_le_half`
  показывают падение меры при существенном уменьшении семейства.
  Добавлена вспомогательная оценка `card_le_mul_card_restrict`, ограничивающая
  размер семейства через произведение размеров обеих ветвей при фиксировании
  координаты.
  *Осталось:* доказать, что при разбиении по чувствительной координате одна из
  ветвей уменьшает меру (например, вывести `2 * |F.restrict i b| ≤ |F|` из
  чувствительности, используя новую оценку), либо перейти к лексикографической
  мере `(measure F, card F)`.

3. **Выбор чувствительного бита**  
   *Сделано:* лемма `non_constant_family_has_sensitive_coord` находит
   чувствительную координату после удаления тождественно ложных функций.  
   *Осталось:* встроить процедуру выбора координаты в основную рекурсию.

4. **Монадическое построение дерева**  
   *Сделано:* разработана стратегия: сначала строится покрытие субкубами, затем
   оно переводится в `DecisionTree`; имеются леммы `Subcube.extend` и
   `monochromaticForFamily_extend_restrict`.  
   *Осталось:* реализовать объединение покрытий и финальное преобразование
   покрытия в дерево.

5. **Оценка глубины**  
   *Сделано:* лемма `DecisionTree.leaf_count_le_pow_depth` связывает число
   листьев с глубиной.  
   *Осталось:* связать её с энтропийной мерой и доказать
   `depth ≤ C · s · log₂(n+1)` по завершении рекурсии.

6. **Оптимизация стиля**  
   *Сделано:* многие технические шаги вынесены во вспомогательные леммы,
   упрощающие основное доказательство.  
   *Осталось:* продолжить рефакторинг, чтобы `decisionTree_cover` оставалась
   короткой и концептуальной.

7. **Гарантия терминирования**  
   *Сделано:* подготовлены леммы, обеспечивающие положительность меры и её
   падение при уменьшении семейства.  
   *Осталось:* окончательно выбрать схему меры (обычная или лексикографическая)
   и доказать, что она строго убывает на каждом шаге рекурсии.

## План дальнейшей работы

1. В `entropy.lean` добавлена лемма `measure_restrict_decreases`, завершающая
   анализ уменьшения энтропийной меры при ограничении семейства.
   Открытый вопрос: как из чувствительной координаты вывести условие
   `2 * |F.restrict i b| ≤ |F|` для некоторого `b`, чтобы применить эту лемму,
   или нужно перейти к лексикографической мере?
2. В `merge_low_sens.lean` добавлены вспомогательные факты
   `merge_card_le_low_sens` и `merge_card_le_entropy`, позволяющие сравнивать
   число субкубов объединённого покрытия с размерами исходных.
3. В `BoolFunc.lean` доказана оценка `card_le_mul_card_restrict`, связывающая
   размер семейства с произведением размеров двух ограничений по координате.
   Требуется связать её с чувствительностью, чтобы получить фактор `1/2`.
4. Переписать `decisionTree_cover` в `low_sensitivity_cover.lean` как
   рекурсивную процедуру, использующую найденную чувствительную координату и
   ограничение меры.
5. Построить дерево из полученного покрытия (`DecisionTree.ofRectCover`) и
   связать глубину с мерой через `leaf_count_le_pow_depth`.
6. Удалить аксиому, обновить `TODO.md` и выполнить `./scripts/check.sh`.

## Ожидаемый результат

После реализации плана аксиома `decisionTree_cover` будет заменена
конструктивной теоремой с границей `depth ≤ 10 · s · log₂(n+1)`, основанной на
строгом убывании выбранной меры.  Это закроет один из ключевых фрагментов
проекта и приблизит доказательство FCE‑Lemma.

