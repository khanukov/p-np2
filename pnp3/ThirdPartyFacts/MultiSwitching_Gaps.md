# MultiSwitching: текущие пробелы

Этот файл фиксирует состояние доказательства на ветке `work` и описывает, чего
не хватает для завершения шага глубины `d → d + 1` в доказательстве
`partial_shrinkage_for_AC0`.

## 1. Данные, которые уже есть

* В модуле `Depth1_Switching.lean` доказаны все локальные утверждения, позволяющие
  по заданной оси и семейству хвостов получить оценку на ошибку `errU`.
* В `MultiSwitching.lean` построены вспомогательные функции нормализации пакетов и
  агрегирования комбинаторных величин (`flattenedCNFs`, `totalBadBound`,
  `combinedTailSelectors` и т.д.). Эти результаты позволяют соединять данные
  нескольких пакетов глубины 1 без потери информации.

## 2. Чего не хватает

1. **Глобальные хвосты.** Для успешной сборки шага `d → d + 1` требуется явное
   семейство хвостов на общей оси, совместимое со списком селекторов,
   возвращаемым `combinedTailSelectors`. Сейчас в `MultiSwitching.lean` нет
   конструкции, которая собирает такие хвосты из данных пакетов.
2. **Упаковка в `CombinedTailCertificate`.** Нужна структура, объединяющая ось,
   глобальные хвосты и оценку ошибки (`epsilon`), чтобы далее построить
   `AxisTailSystem.TailCertificate` и вызвать конструктор частичного
   сертификата. Пока такая упаковка отсутствует.
3. **Конструктор `Depth1WitnessInput.build`.** После появления глобальных хвостов
   нужно реализовать функцию, которая из `CombinedTailCertificate` возвращает
   готовый ввод глубины 1 для верхнего уровня индукции. Это связующее звено между
   собранными хвостами и частичным сертификатом глубины `d + 1`.
4. **Удаление `sorry`.** Любые временные заглушки в новой инфраструктуре должны
   быть заменены на полноценные доказательства до финального рефакторинга.

## 3. Следующие шаги

1. Построить явные хвостовые PDT на общей оси (например, через конкатенацию
   локальных хвостов пакетов) и доказать, что их листья совпадают с селекторами,
   выдаваемыми `combinedTailSelectors`.
2. Оформить полученные данные в структуру `CombinedTailCertificate` и вывести
   леммы о контроле ошибки, глубины и принадлежности селекторов листьям.
3. На основе `CombinedTailCertificate` реализовать `Depth1WitnessInput.build` и
   убедиться, что итоговый частичный сертификат соответствует бюджету глубины
   `depthBudget M (d + 1)`.
4. После завершения этих шагов обновить `Facts_Switching.lean`, заменив аксиому
   `partial_shrinkage_for_AC0` на доказанную теорему.

Этот список будет обновляться по мере продвижения формализации.
